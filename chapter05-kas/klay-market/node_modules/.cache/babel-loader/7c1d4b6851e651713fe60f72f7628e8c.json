{"ast":null,"code":"import Caver from 'caver-js';\nimport KIP17ABI from '../abi/KIP17TokenABI.json';\nimport { ACCESS_KEY_ID, SECRET_ACCESS_KEY, NFT_CONTRACT_ADDRESS, MARKET_CONTRACT_ADDRESS, CHAIN_ID } from '../constants';\nconst option = {\n  headers: [{\n    name: \"Authorization\",\n    value: \"Basic \" + Buffer.from(ACCESS_KEY_ID + \":\" + SECRET_ACCESS_KEY).toString(\"base64\")\n  }, {\n    name: \"x-chain-id\",\n    value: CHAIN_ID\n  }]\n};\nconst caver = new Caver(new Caver.providers.HttpProvider(\"https://node-api.klaytnapi.com/v1/klaytn\", option));\nconst NFTContract = new caver.contract(KIP17ABI, NFT_CONTRACT_ADDRESS);\nexport const fetchCardsOf = async address => {\n  // Fetch getBalance\n  const balance = await NFTContract.methods.balanceOf(address).call();\n  console.log(`[NFT Balance] ${balance}`); // Fetch Token IDs\n\n  const tokenIds = [];\n\n  for (let i = 0; i < balance; i++) {\n    const id = await NFTContract.methods.tokenOfOwnerByIndex(address, i).call();\n    tokenIds.push(id);\n  } // Fetch Token URIs\n\n\n  const tokenUris = [];\n\n  for (let i = 0; i < balance; i++) {\n    const metadataUrl = await NFTContract.methods.tokenURI(tokenIds[i]).call(); // -> metadata kas 주소\n\n    const response = await axios.get(metadataUrl); // 실제 메타데이터가 들어있다.\n\n    const uriJson = response.data;\n    tokenUris.push(uriJson.image);\n  }\n\n  const nfts = [];\n\n  for (let i = 0; i < balance; i++) {\n    nfts.push({\n      uri: tokenUris[i],\n      id: tokenIds[i]\n    });\n  }\n\n  console.log(nfts);\n  return nfts;\n};\nexport const getBalance = address => {\n  return caver.rpc.klay.getBalance(address).then(respose => {\n    const balance = caver.utils.convertFromPeb(caver.utils.hexToNumberString(respose));\n    console.log(`BALANCE: ${balance}`);\n    return balance;\n  });\n};","map":{"version":3,"sources":["/workspace/ProjectLion_BlockCha/chapter05-kas/klay-market/src/api/UseCaver.js"],"names":["Caver","KIP17ABI","ACCESS_KEY_ID","SECRET_ACCESS_KEY","NFT_CONTRACT_ADDRESS","MARKET_CONTRACT_ADDRESS","CHAIN_ID","option","headers","name","value","Buffer","from","toString","caver","providers","HttpProvider","NFTContract","contract","fetchCardsOf","address","balance","methods","balanceOf","call","console","log","tokenIds","i","id","tokenOfOwnerByIndex","push","tokenUris","metadataUrl","tokenURI","response","axios","get","uriJson","data","image","nfts","uri","getBalance","rpc","klay","then","respose","utils","convertFromPeb","hexToNumberString"],"mappings":"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","sourcesContent":["import Caver from 'caver-js';\nimport KIP17ABI from '../abi/KIP17TokenABI.json';\nimport {ACCESS_KEY_ID, SECRET_ACCESS_KEY, NFT_CONTRACT_ADDRESS, MARKET_CONTRACT_ADDRESS, CHAIN_ID} from '../constants';\n\nconst option = {\n\theaders: [\n\t\t{\n\t\t\tname: \"Authorization\",\n\t\t\tvalue: \"Basic \" + Buffer.from(ACCESS_KEY_ID + \":\" + SECRET_ACCESS_KEY).toString(\"base64\")\n\t\t},\n\t\t{\n\t\t\tname: \"x-chain-id\", value: CHAIN_ID\n\t\t}\n\t]\n}\n\nconst caver = new Caver(new Caver.providers.HttpProvider(\"https://node-api.klaytnapi.com/v1/klaytn\", option));\nconst NFTContract = new caver.contract(KIP17ABI,NFT_CONTRACT_ADDRESS);\n\n\nexport const fetchCardsOf = async (address) => {\n\t// Fetch getBalance\n\tconst balance = await NFTContract.methods.balanceOf(address).call();\n\tconsole.log(`[NFT Balance] ${balance}`);\n\t// Fetch Token IDs\n\tconst tokenIds = [];\n\tfor(let i =0; i<balance; i++){\n\t\tconst id = await NFTContract.methods.tokenOfOwnerByIndex(address, i).call(); \n\t\ttokenIds.push(id);\n\t}\n\t\n\t// Fetch Token URIs\n\tconst tokenUris = [];\n\tfor(let i =0; i<balance; i++){\n\t\tconst metadataUrl = await NFTContract.methods.tokenURI(tokenIds[i]).call(); // -> metadata kas 주소\n\t\tconst response = await axios.get(metadataUrl); // 실제 메타데이터가 들어있다.\n\t\tconst uriJson = response.data;\n\t\t\n\t\ttokenUris.push(uriJson.image);\n\t}\n\t\n\tconst nfts = [];\n\tfor(let i =0; i<balance; i++){\n\t\tnfts.push({uri: tokenUris[i], id: tokenIds[i] });\n\t}\n\tconsole.log(nfts);\n\treturn nfts;\n}\n\nexport const getBalance = (address) => {\n\treturn caver.rpc.klay.getBalance(address).then((respose) => {\n\t\tconst balance = caver.utils.convertFromPeb(caver.utils.hexToNumberString(respose));\n\t\tconsole.log(`BALANCE: ${balance}`); \n\t\treturn balance;\n\t})\n}\n"]},"metadata":{},"sourceType":"module"}